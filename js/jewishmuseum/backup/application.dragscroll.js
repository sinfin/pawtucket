// Generated by CoffeeScript 1.3.3
(function() {
  var createPagination, initReader;

  initReader = function() {
    var count, r;
    window.scrollTimer = false;
    r = window.reader;
    r.height($(window).height() - 55);
    $(window).scrollTop(0).scrollTop(r.parent('#images').offset().top - 15);
    r.dragscrollable({
      dragSelector: 'li'
    });
    window.offsets = [];
    r.find('li').each(function(index) {
      return window.offsets[index] = $(this).position().top;
    });
    count = r.find('li').length;
    createPagination(count);
    return $(window).resize(function() {
      return r.height($(window).height() - 55);
    });
  };

  createPagination = function(count) {
    var num, offsets, options, _i;
    options = [];
    offsets = window.offsets;
    for (num = _i = 1; 1 <= count ? _i <= count : _i >= count; num = 1 <= count ? ++_i : --_i) {
      options[num] = '<option value="' + num + '">Page #' + num + '</option>';
    }
    window.reader.before('<div id="detail-left-pagination"><select name="pagination" id="detail-left-select">' + options.join('') + '</select></div>');
    window.readerSelect = $('#detail-left-select', '#detail-left');
    window.readerSelect.bind('change', function() {
      return window.reader.scrollTop(offsets[$(this).val() - 1]);
    });
    window.reader.bind('scroll', function() {
      if (window.scrollTimer) {
        clearTimeout(window.scrollTimer);
      }
      return window.scrollTimer = setTimeout(function() {
        return window.reader.trigger('scrollchange');
      }, 200);
    });
    return window.reader.bind('scrollchange', function() {
      var n, o;
      o = $(this).scrollTop();
      n = 0;
      while (n < offsets.length && (offsets[n] + window.reader.height() / 2) < o) {
        n++;
      }
      return window.readerSelect.val(n + 1);
    });
  };

  $(function() {
    return window.reader = $('> ul', '#images');
  });

}).call(this);
